i1 = data$V2
i2 = data$V3
i3 = data$V4
i4 = data$V5
i5 = data$V6
i6 = data$V7
i7 = data$V8
n7 = rowSums(data[2:8])
n30 = rowSums(data[2:31])
burst = data$V32
bv = n7 * burst
reg = lm(n30 ~ i1 + i2 + i3 + i4 + i5 + i6 + i7 + bv - 1, weights = (1 / n30)^2)
summary(reg)
reg$coefficients
data = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/rpart/I30_training_bp_predicted_1100000', sep = ''))
i1 = data$V2
i2 = data$V3
i3 = data$V4
i4 = data$V5
i5 = data$V6
i6 = data$V7
i7 = data$V8
n7 = rowSums(data[2:8])
n30 = rowSums(data[2:31])
burst = data$V32
bv = n7 * burst
reg = lm(n30 ~ i1 + i2 + i3 + i4 + i5 + i6 + i7 + bv - 1, weights = (1 / n30)^2)
summary(reg)
reg$coefficients
data = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/rpart/I30_training_bp_predicted_0000000', sep = ''))
i1 = data$V2
i2 = data$V3
i3 = data$V4
i4 = data$V5
i5 = data$V6
i6 = data$V7
i7 = data$V8
n7 = rowSums(data[2:8])
n30 = rowSums(data[2:31])
burst = data$V32
bv = n7 * burst
reg = lm(n30 ~ i1 + i2 + i3 + i4 + i5 + i6 + i7 + bv - 1, weights = (1 / n30)^2)
summary(reg)
reg$coefficients
data = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/rpart/I30_training_bp_predicted_others', sep = ''))
i1 = data$V2
i2 = data$V3
i3 = data$V4
i4 = data$V5
i5 = data$V6
i6 = data$V7
i7 = data$V8
n7 = rowSums(data[2:8])
n30 = rowSums(data[2:31])
burst = data$V32
bv = n7 * burst
reg = lm(n30 ~ i1 + i2 + i3 + i4 + i5 + i6 + i7 + bv - 1, weights = (1 / n30)^2)
summary(reg)
reg$coefficients
library(rpart)
library(rpart.plot)
workpath = 'F:/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
training_df = as.data.frame(training[, 3:length(training)])
set.seed(10)
mytree = rpart(label ~ ., training_df, control = rpart.control(xval = 10, cp = 0.001));
tree_cp = printcp(mytree)
prune_cp_row = min((1 : dim(tree_cp)[1])[tree_cp[,"xerror"] < min(tree_cp[, "xerror"] + tree_cp[, "xstd"])])
mytree_prune = prune(mytree, cp = tree_cp[prune_cp_row, "CP"])
printcp(mytree_prune)
print(mytree_prune$variable.importance);
plot(mytree_prune);
training_df2 = cbind(training_df[, 1], training_df[, 2])
View(training_df2)
training_df2 = cbind(training_df[1, ], training_df[2, ])
training_df2 = cbind(training_df[, 1], training_df[, 2])
training_df2 = as.data.frame(cbind(training[, 3], training[, 4]))
idx = c((1:3), 2)
idx = c((3:38), (46:53))
idx
training_df2 = as.data.frame(training[, idx])
idx = c((3:41), (49:56))
training_df2 = as.data.frame(training[, idx])
set.seed(10)
mytree2 = rpart(label ~ ., training_df2, control = rpart.control(xval = 10, cp = 0.001));
tree_cp2 = printcp(mytree2)
prune_cp_row2 = min((1 : dim(tree_cp2)[1])[tree_cp2[,"xerror"] < min(tree_cp2[, "xerror"] + tree_cp2[, "xstd"])])
mytree_prune2 = prune(mytree2, cp = tree_cp2[prune_cp_row2, "CP"])
printcp(mytree_prune2)
print(mytree_prune2$variable.importance);
printcp(mytree_prune)
printcp(mytree_prune2)
print(mytree_prune2$variable.importance);
library(rpart)
library(rpart.plot)
workpath = 'F:/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
idx = c((3:41), (49:56))
training_df2 = as.data.frame(training[, idx])
set.seed(10)
mytree2 = rpart(label ~ ., training_df2, control = rpart.control(xval = 10, cp = 0.001));
tree_cp2 = printcp(mytree2)
prune_cp_row2 = min((1 : dim(tree_cp2)[1])[tree_cp2[,"xerror"] < min(tree_cp2[, "xerror"] + tree_cp2[, "xstd"])])
mytree_prune2 = prune(mytree2, cp = tree_cp2[prune_cp_row2, "CP"])
printcp(mytree_prune2)
print(mytree_prune2$variable.importance);
predict = predict(mytree_prune, training, type = 'class')
predict = predict(mytree_prune2, training, type = 'class')
ll = c(training$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
out_df <- data.frame(training$vid, ll - 1, pl - 1);
write.table(out_df,
file = paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/rpart/I30_training_results', sep = ''),
sep = '\t', quote = FALSE, col.names = FALSE, row.names = FALSE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
predict = predict(mytree_prune, test, type = 'class')
predict = predict(mytree_prune2, test, type = 'class')
ll = c(test$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
out_df <- data.frame(test$vid, ll - 1, pl - 1);
write.table(out_df,
file = paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection//rpart/I30_test_results', sep = ''),
sep = '\t', quote = FALSE, col.names = FALSE, row.names = FALSE)
training_df = as.data.frame(training[, 3:length(training)])
set.seed(10)
mytree = rpart(label ~ ., training_df, control = rpart.control(xval = 10, cp = 0.001));
tree_cp = printcp(mytree)
#1-SE rule
prune_cp_row = min((1 : dim(tree_cp)[1])[tree_cp[,"xerror"] < min(tree_cp[, "xerror"] + tree_cp[, "xstd"])])
mytree_prune = prune(mytree, cp = tree_cp[prune_cp_row, "CP"])
printcp(mytree_prune)
print(mytree_prune$variable.importance);
predict = predict(mytree_prune, training, type = 'class')
ll = c(training$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
predict = predict(mytree_prune, test, type = 'class')
ll = c(test$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
predict = predict(mytree_prune, training, type = 'class')
ll = c(training$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
out_df <- data.frame(training$vid, ll - 1, pl - 1);
write.table(out_df,
file = paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/rpart/I30_training_results_i', sep = ''),
sep = '\t', quote = FALSE, col.names = FALSE, row.names = FALSE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
predict = predict(mytree_prune, test, type = 'class')
ll = c(test$label)
pl = c(predict)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
out_df <- data.frame(test$vid, ll - 1, pl - 1);
write.table(out_df,
file = paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection//rpart/I30_test_results_i', sep = ''),
sep = '\t', quote = FALSE, col.names = FALSE, row.names = FALSE)
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
str(training$statuses_count)
str(test$statuses_count)
summary(training$statuses_count)
summary(test$statuses_count)
training$statuses_count = NULL
test$statuses_count = NULL
str(training)
str(test)
levels(test$public_type) = levels(training$public_type)
str(test)
library(rpart)
#workpath = 'F:/Video_Popularity/'
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
training$statuses_count = NULL
test$statuses_count = NULL
levels(test$public_type) = levels(training$public_type)
training_l = training[, 3]
training_f = as.data.frame(training[, 4:length(training)])
test_l = test[, 3]
test_f = as.data.frame(test[, 4:length(test)])
training_d = as.data.frame(training[, 3:length(training)])
test_d = as.data.frame(test[, 3:length(test)])
set.seed(10)
tree = rpart(label ~ ., training_d, control = rpart.control(xval = 10, cp = 0.001));
tree_cp = printcp(tree)
#1-SE rule
pruned_cp_row = min((1 : dim(tree_cp)[1])[tree_cp[,"xerror"] < min(tree_cp[, "xerror"] + tree_cp[, "xstd"])])
tree_pruned = prune(tree, cp = tree_cp[pruned_cp_row, "CP"])
prediction = predict(tree_pruned, training_f, type = 'class')
ll = c(training_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
prediction = predict(tree_pruned, test_f, type = 'class')
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
2026 + 9194
library(randomForest)
#workpath = 'F:/Video_Popularity/'
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
training$statuses_count = NULL
test$statuses_count = NULL
levels(test$public_type) = levels(training$public_type)
training_l = training[, 3]
training_f = as.data.frame(training[, 4:length(training)])
training_d = as.data.frame(training[, 3:length(training)])
test_l = test[, 3]
test_f = as.data.frame(test[, 4:length(test)])
test_d = as.data.frame(test[, 3:length(test)])
set.seed(10)
forest = randomForest(label ~ ., training_d)
# training performance
ll = c(training_l)
pl = c(forest$predicted)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
prediction = predict(forest, test_f, type = 'class')
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
set.seed(10)
prediction = predict(forest, test_f, type = 'class')
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
library(randomForest)
#workpath = 'F:/Video_Popularity/'
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
training$statuses_count = NULL
test$statuses_count = NULL
levels(test$public_type) = levels(training$public_type)
training_l = training[, 3]
training_f = as.data.frame(training[, 4:length(training)])
training_d = as.data.frame(training[, 3:length(training)])
test_l = test[, 3]
test_f = as.data.frame(test[, 4:length(test)])
test_d = as.data.frame(test[, 3:length(test)])
set.seed(10)
forest = randomForest(label ~ ., training_d, ntree = 501)
prediction = predict(forest, test_f, type = 'class')
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
2370 + 9088
library(class)
#workpath = 'F:/Video_Popularity/'
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
training$statuses_count = NULL
test$statuses_count = NULL
levels(test$public_type) = levels(training$public_type)
training_l = training[, 3]
training_f = as.data.frame(training[, 4:length(training)])
training_d = as.data.frame(training[, 3:length(training)])
test_l = test[, 3]
test_f = as.data.frame(test[, 4:length(test)])
test_d = as.data.frame(test[, 3:length(test)])
title_booktitle_flag = training_f$title_booktitle_flag
title_booktitle_flag = model.matrix(~title_booktitle_flag-1)
training_f$title_booktitle_flag = NULL
category = training_f$category
category = model.matrix(~category-1)
training_f$category = NULL
public_type = training_f$public_type
public_type = model.matrix(~public_type-1)
training_f$public_type = NULL
copyright_type = training_f$copyright_type
copyright_type = model.matrix(~copyright_type-1)
training_f$copyright_type = NULL
streamtypes_hd2 = training_f$streamtypes_hd2
streamtypes_hd2 = model.matrix(~streamtypes_hd2-1)
training_f$streamtypes_hd2 = NULL
gender = training_f$gender
gender = model.matrix(~gender-1)
training_f$gender = NULL
is_vip = training_f$is_vip
is_vip = model.matrix(~is_vip-1)
training_f$is_vip = NULL
is_share = training_f$is_share
is_share = model.matrix(~is_share-1)
training_f$is_share = NULL
is_verified = training_f$is_verified
is_verified = model.matrix(~is_verified-1)
training_f$is_verified = NULL
training_f = cbind(training_f, title_booktitle_flag, category, public_type, copyright_type,
streamtypes_hd2, gender, is_vip, is_share, is_verified)
title_booktitle_flag = test_f$title_booktitle_flag
title_booktitle_flag = model.matrix(~title_booktitle_flag-1)
test_f$title_booktitle_flag = NULL
category = test_f$category
category = model.matrix(~category-1)
test_f$category = NULL
public_type = test_f$public_type
public_type = model.matrix(~public_type-1)
test_f$public_type = NULL
copyright_type = test_f$copyright_type
copyright_type = model.matrix(~copyright_type-1)
test_f$copyright_type = NULL
streamtypes_hd2 = test_f$streamtypes_hd2
streamtypes_hd2 = model.matrix(~streamtypes_hd2-1)
test_f$streamtypes_hd2 = NULL
gender = test_f$gender
gender = model.matrix(~gender-1)
test_f$gender = NULL
is_vip = test_f$is_vip
is_vip = model.matrix(~is_vip-1)
test_f$is_vip = NULL
is_share = test_f$is_share
is_share = model.matrix(~is_share-1)
test_f$is_share = NULL
is_verified = test_f$is_verified
is_verified = model.matrix(~is_verified-1)
test_f$is_verified = NULL
test_f = cbind(test_f, title_booktitle_flag, category, public_type, copyright_type,
streamtypes_hd2, gender, is_vip, is_share, is_verified)
set.seed(10)
prediction = knn(training_f, test_f, training_l, k = 9)
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
accuracy = rep(0, 10)
k = 1:10
for(x in k){
set.seed(10)
prediction <- knn(training_f, test_f, training_l, k = x)
accuracy[x] <- mean(prediction == test_l)
}
plot(k, accuracy, type = 'b')
library(randomForest)
#workpath = 'F:/Video_Popularity/'
workpath = '/Users/ouyangshuxin/Documents/work/Video_Popularity/'
training = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/training/I30_training_bp_features', sep = ''), header = TRUE)
test = read.table(paste(workpath, 'analysis/2_predict_value/PBML/150801+151017/burst_detection/test/I30_test_bp_features', sep = ''), header = TRUE)
training$statuses_count = NULL
test$statuses_count = NULL
levels(test$public_type) = levels(training$public_type)
training_l = training[, 3]
training_f = as.data.frame(training[, 4:length(training)])
training_d = as.data.frame(training[, 3:length(training)])
test_l = test[, 3]
test_f = as.data.frame(test[, 4:length(test)])
test_d = as.data.frame(test[, 3:length(test)])
set.seed(10)
forest = randomForest(label ~ ., training_d, ntree = 501)
# test performance
prediction = predict(forest, test_f, type = 'class')
ll = c(test_l)
pl = c(prediction)
# burst
length(which(ll == 2))
# not burst
length(which(ll == 1))
# burst -> burst
length(which(pl == ll & ll == 2))
# burst -> not burst
length(which(pl != ll & ll == 2))
# not burst -> not burst
length(which(pl == ll & ll == 1))
# not burst -> burst
length(which(pl != ll & ll == 1))
